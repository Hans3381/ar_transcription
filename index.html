<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Real-Time AR Caption</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
    }
    video {
      position: absolute;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 1;
    }
    .caption {
      position: absolute;
      color: #00FF00;
      background-color: rgba(0, 0, 0, 0.7);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 1.5rem;
      font-weight: bold;
      z-index: 2;
      transform: translate(-50%, -100%);
      pointer-events: none;
      white-space: nowrap;
    }
  </style>
</head>
<body>

<video id="video" autoplay muted playsinline></video>
<div id="caption" class="caption">Menunggu suara...</div>

<script type="module">
  import { FaceDetector } from 'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3';

  const video = document.getElementById('video');
  const caption = document.getElementById('caption');

  // Aktifkan kamera
  const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
  video.srcObject = stream;

  // Buat face detector
  const face = await FaceDetector.createFromOptions({
    baseOptions: { modelAssetPath: 'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision/face_landmarker.task' },
    runningMode: 'VIDEO',
    numFaces: 1,
    outputFaceBlendshapes: false,
    outputFacialTransformationMatrixes: false,
  });

  // Deteksi wajah terus menerus
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');

  async function detect() {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    const detections = await face.detect(canvas);
    if (detections.detections.length > 0) {
      const box = detections.detections[0].boundingBox;
      const centerX = box.originX + box.width / 2;
      const topY = box.originY;

      // Geser teks ke posisi wajah (responsif ke layar)
      const screenX = (centerX / video.videoWidth) * window.innerWidth;
      const screenY = (topY / video.videoHeight) * window.innerHeight;
      caption.style.left = `${screenX}px`;
      caption.style.top = `${screenY}px`;
    }
    requestAnimationFrame(detect);
  }

  video.onloadedmetadata = () => detect();

  // Web Speech API - real-time transkripsi
  const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang = 'id-ID';
  recognition.continuous = true;
  recognition.interimResults = true;

  recognition.onresult = (event) => {
    let hasil = '';
    for (let i = event.resultIndex; i < event.results.length; ++i) {
      hasil += event.results[i][0].transcript;
    }
    caption.textContent = hasil || 'Menunggu suara...';
  };

  recognition.onerror = (e) => {
    caption.textContent = 'Error: ' + e.error;
  };

  recognition.start();
</script>

</body>
</html>
